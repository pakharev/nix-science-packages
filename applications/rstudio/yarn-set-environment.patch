--- a/src/gwt/build.xml
+++ b/src/gwt/build.xml
@@ -84,33 +84,31 @@
    </target>
 
    <!-- panmirror typescript library -->
    <property name="yarn.bin" value="@yarn@/bin/yarn"/>
-   <property name="panmirror.dir" value="./lib/quarto/apps/panmirror"/>
+   <property name="quarto.dir" value="./lib/quarto"/>
+   <property name="panmirror.dir" value="${quarto.dir}/apps/panmirror"/>
    <property name="panmirror.build.dir" value="./www/js/panmirror"/>
 
-   <!-- use panmirror from /opt/rstudio-tools if available (typical for Docker) -->
-   <available
-      property="panmirror.dir"
-      value="/opt/rstudio-tools/src/gwt/lib/quarto/apps/panmirror"
-      file="/opt/rstudio-tools/src/gwt/lib/quarto/apps/panmirror"/>
-   <!-- use yarn from c:/rstudio-tools if installed (typical for Docker on Windows) -->
-   <available
-      property="panmirror.dir"
-      value="c:\rstudio-tools\src\gwt\lib\quarto\apps\panmirror"
-      file="c:\rstudio-tools\src\gwt\lib\quarto\apps\panmirror"/>
-
    <target name="panmirror" description="Compile panmirror library">
       <echo message="yarn location: ${yarn.bin}"/>
       <echo message="panmirror location: ${panmirror.dir}"/>
       <mkdir dir="${panmirror.build.dir}"/>
       <exec executable="${yarn.bin}" dir="${panmirror.dir}" resolveexecutable="true" failonerror="true">
          <arg value="install"/>
-         <arg value="--network-timeout"/>
-         <arg value="240000"/>
+         <arg value="--ignore-scripts"/>
+         <env key="HOME" file="${quarto.dir}"/>
+         <env key="YARN_CACHE_FOLDER" file="${quarto.dir}/.yarn_cache"/>
       </exec>
+      <exec executable="bash" dir="${quarto.dir}" resolveexecutable="true" failonerror="true">
+         <arg value="patchShebangs"/>
+         <arg value="--build"/>
+         <arg value="."/>
+      </exec>
       <exec executable="${yarn.bin}" dir="${panmirror.dir}" resolveexecutable="true" failonerror="true">
          <arg value="build"/>
          <env key="PANMIRROR_OUTDIR" value="dist-rstudio"/>
+         <env key="HOME" file="${quarto.dir}"/>
+         <env key="YARN_CACHE_FOLDER" file="${quarto.dir}/.yarn_cache"/>
       </exec>
       <copy todir="${panmirror.build.dir}">
          <fileset dir="${panmirror.dir}/dist-rstudio"/>
